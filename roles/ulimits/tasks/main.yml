---
# Ulimits role tasks

- name: Ensure systemd override directory exists
  ansible.builtin.file:
    path: /etc/systemd/system.conf.d
    state: directory
    mode: "0755"
  tags:
    - ulimits

- name: Configure system-wide ulimits
  ansible.builtin.template:
    src: limits.conf.j2
    dest: "{{ ulimits_limits_file }}"
    owner: root
    group: root
    mode: "0644"
  tags:
    - ulimits

- name: Configure systemd default limits
  ansible.builtin.template:
    src: systemd-limits.conf.j2
    dest: "{{ ulimits_systemd_file }}"
    owner: root
    group: root
    mode: "0644"
  notify: Reload systemd
  tags:
    - ulimits
